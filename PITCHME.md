## Внедрение Bluetooth Low Energy в систему PERCo

Аубакиров Санжар

Мурашкин Данил

---

### Содержание

- Постановка задачи
- PERCo СКУД
- Reverse Engineering PERCo-KT02
- Эксперимент с управлением приводом
- Решения задачи
- Интеграция с PERCo-KT02
- Дальнейшие планы

---

### Постановка задачи

Модернизация системы контроля доступа с идентификаторами RFID на BLE с дальнейшим использованием смартфонов в качестве идентификаторов

Note:

Модернизация системы контроля доступа с идентификаторами RFID на BLE с дальнейшим использованием смартфонов в качестве идентификаторов. Департамент информационных технологий КазНУ предоставил нам один турникет для экспериментов.

---

#### Знакомство c PERCo-KT02

![Турникет](https://image.ibb.co/jUgWOy/Selection_039.png)

Note:
На официальном сайте perco.ru мы нашли описание турникетов и техническую документацию. Однако мы не смогли найти в открытых источниках электронную схему управления приводом 

---

#### Основные компоненты системы

![Общая схема](https://image.ibb.co/dRd9bJ/Selection_040.png)

Note:
На этом изображении показана схема устройства турникета. Для простоты были удалены все лишние детали и оставлены только те, которые требуются для общего понимания.

---

#### Схема работы

![Схема работы](https://image.ibb.co/dePqiy/Turniket.png)

Note:
Работа построены следующим образом. Пользователь подносит карточку к RFID считывателю, считыватель сообщает ID карты контроллеру, контроллер сверяет ID карты со своей локальной базой, контроллер использует драйверы для прокрутки мотора планок. Обратите внимание что считыватели и драйвера разные для входа и для выхода.

Первым делом мы решили подключиться к мотору управления планками напрямую, игнорируя основной контроллер.

---

#### Первая схема работа с Bluetooth 

![Схема работы](https://image.ibb.co/femviy/Turniket2.png)

Note:
На первом этапе было важно показать, что управлять турникетом возможно в принципе. Поэтому мы взялись за сброку адаптера для управления мотором напрямую, отключив контроллер и считыватели RFID. Основной задачей первого этапа было проверить на сколько удобно будет управлять турникетом через Bluetooth и ответить на следующие вопросы

---

#### Вопросы первого этапа

- Будет ли это достаточно быстро?
- Сможем ли мы отличать вход от выхода?
- Будет ли это удобно пользователям?

Note:

Здесь важно было ответить на следующие вопросы. Сможем ли мы организовать достаточно быстрый обмен данными, достаточный для того, чтобы пользователи не испытывали дискомфорт.

Второй важной задачей было понять сможем ли мы отличать когда человек входит, а когда выходит. Я постараюсь объяснить это на следующем слайде.

Последний вопрос, будет ли пользователям удобно. Нужно разработать удобное и быстрое приложение, которое не будет вызывать неудобств.

---

#### Отличать вход/выход

![Вход/Выход](https://image.ibb.co/ekyEty/Turniket3.png)

Note:

Представим себе мысленный эксперимент. Человек подходит с телефоном к турникету, включает приложение, а затем нажимает кнопку Вход или Выход. Здесь пользователь должен сам знать входит он или выходит. Такой подход пораждает много вопросов и неудобств. Поэтому мы от него отказались.

Давайте представим другую ситуацию. Человек подходит с телефоном к турникету и просто подносит его к корпусу турникета. Задача определения Вход или Выход ложится на наше оборудование. Чтобы решить эту задачу мы использовали два блютуз передатчика, которые физически разнесены по краям турникета. Таким образом по силе радиосигнала на смартфоне мы можем сказать к какому из блютуз передатчиков мы сейчас ближе и вызвать открытие соответствующей стороны.

---

#### Сила радиосигнала

- RSSI как мера измерения силы радиосигнала

![Radio](https://image.ibb.co/fjTaJy/Turniket5.png)

Note:
Показатель уровня принимаемого сигнала, RSSI (англ. received signal strength indicator) (телекоммуникации) — полная мощность принимаемого приёмником сигнала. Измеряется приёмником по логарифмической шкале в дБм
Интерференция радио волн создает помехи, которые мешают точно определить силу сигнала. Для того чтобы создать направленную радио антенну требуется особое оборудование, которого у нас. Поэтому для этого эксперимента мы воспользовались аллюминиевой фольгой. Проводник экранирует распространение радио волн.

---

#### Эксперимент. Управление приводом

![Video](https://www.youtube.com/embed/DlDGJn8U75E)

---

#### Эксперимент. Управление приводом

![Video](https://www.youtube.com/embed/fcC2bQZKaLc)

---

#### Proof of concept

- Показали что это возможно
- Создали удобный и быстрый протокол обмена данными
- Создали прототип Android приложения
- Доказали что такой способ тоже удобный

Note:

Следующим этапом мы расскажем об интеграции с системой управления и контроля доступом

---

#### Интеграция в СКУД

- Заменить контроллер PERCo своим оборудованием и своей информационной системой;
- Интегрироваться в систему KT-02, инсталлировать Bluetooth устройства в качестве новых считывателей.

Note:
Далее расскажем о полноценной интеграции в СКУД
Первое решение позволит полностью отказаться от RFID карт и отказаться от оборудования PERCo. Мы сможем сами изготавливать управляющие платы. Однако это решение потреюует создания своей информационной системы контроля и управления доступом, которое будет интегрированно в систему Univer. Разработка такой системы может занять от двух до трех месяцев.

Второе решение позволит одновременно работать и RFID карточкам и приложению с Blueotooth. Мы сможем провести полноценное тестирование без вреда основной системы.

--- 

#### Reverse engineering

![Реверс](https://image.ibb.co/jA3TmJ/Selection_043.png)

---

#### Reverse engineering

![Реверс](https://image.ibb.co/bBG9ty/photo_2018_05_10_10_11_45.jpg)

---

#### Протокол

1. 0xAA — код начала команды
2. 0x[02][12] — идентификатор считывателя
3. 0x0[15] — код команды
4. Данные, связанные с командой
5. контрольная сумма CRC16

---

#### Дальнейшие планы

Планируем закончить к 1-му июня
- Создать адаптеры для подключения наших плат
- Регистрация считывателей в системе
- Установки платы
- Внедрение BLE библиотеки в приложение UNIVER

---

#### Финальная схема

![Схема](https://image.ibb.co/co3aJy/Turniket4.png)
